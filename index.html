<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chattanooga Hackers Anonymous (CHA)</title>
  <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: 
        linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0.9)), 
        url('aW1hZ2VzCg==/background.png') no-repeat center center fixed;
      background-size: 100% 100%;
      font-family: 'Courier New', Courier, monospace;
      color: #33ff33;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .window {
      width: 800px;
      height: 480px;
      background-color: rgba(0, 0, 0, 0.95);
      box-shadow: 0 0 30px #00ff00;
      border: 1px solid #222;
      display: flex;
      flex-direction: column;
    }

    .title-bar {
      height: 30px;
      background-color: #222;
      display: flex;
      align-items: center;
      padding: 0 10px;
      color: #ccc;
      font-size: 0.9rem;
      justify-content: space-between;
    }

    .window-controls {
      display: flex;
      gap: 6px;
    }

    .window-controls div {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #444;
    }

    .close { background-color: #ff5f56; }
    .minimize { background-color: #ffbd2e; }
    .maximize { background-color: #27c93f; }

    .terminal {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
      border-top: 1px solid #333;
    }

    .terminal-content {
      position: relative;
      z-index: 2;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .prompt {
      font-weight: bold;
      display: flex;
      align-items: center;
      margin-top: 8px;
      visibility: hidden; /* initially hidden */
    }

    .cursor {
      width: 10px;
      height: 1em;
      background-color: #33ff33;
      margin-left: 5px;
      animation: blink 1s steps(1) infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="window">
    <div class="title-bar">
      <div class="window-controls">
        <div class="close"></div>
        <div class="minimize"></div>
        <div class="maximize"></div>
      </div>
      <div>root@cha:~</div>
    </div>
    <div class="terminal">
      <div class="terminal-content" id="terminalContent">
        <div class="prompt" id="promptLine">
          <span id="promptText">root@cha:~# </span><span class="cursor"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const terminal = document.getElementById('terminalContent');
      const prompt = document.getElementById('promptLine');
      const promptText = document.getElementById('promptText');

      const bootLines = [
        "CHA // Chattanooga Hackers Anonymous",
        "",
        "Booting up node...",
        "Initializing protocol...",
        "Establishing secure connection...",
        "Access granted.",
        ""
      ];

      const quotes = [
        "Another one got caught today, it's all over the papers.",
        "My crime is that of curiosity.",
        "I am a hacker, and this is my manifesto.",
        "You may stop this individual, but you can't stop us all... after all, we're all alike.",
        "We explore... and you call us criminals.",
        "We seek after knowledge... and you call us criminals.",
        "We exist without skin color, without nationality, without religious bias.",
        "You build atomic bombs, you wage wars, you murder, cheat, and lie to us and try to make us believe it's for our own good.",
        "This is our world now... the world of the electron and the switch, the beauty of the baud.",
        "We make use of a service already existing without paying for what could be dirt-cheap if it wasn't run by profiteering gluttons.",
        "We explore... and you call us criminals. We seek after knowledge... and you call us criminals.",
        "We exist without borders, without limits.",
        "We don't do it for money. We do it because it's who we are.",
        "Yes, I am a criminal. My crime is that of curiosity.",
        "My crime is that of outsmarting you, something that you will never forgive me for.",
        "We tinker, we test, we break, we learn.",
        "This is it... this is where I belong.",
        "You bet your ass we're all alike.",
        "I’ve learned more from a Commodore 64 than from all the teachers at school.",
        "We are the hackers of the world."
      ];

      let commandBuffer = "";
      let lineIndex = 0;
      let charIndex = 0;
      const typingSpeed = 40;
      const lineDelay = 600;

      function escapeHtml(text) {
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      }

      function scrollToBottom() {
        const container = document.querySelector('.terminal');
        container.scrollTop = container.scrollHeight;
      }

      function updatePrompt() {
        promptText.innerHTML = `root@cha:~# ${escapeHtml(commandBuffer)}`;
        scrollToBottom();
      }

      function typeQuote(quote, index = 0, doneCallback = () => {}) {
        if (index < quote.length) {
          const span = document.createElement('span');
          span.innerText = quote.charAt(index);
          terminal.insertBefore(span, prompt);
          scrollToBottom();
          setTimeout(() => typeQuote(quote, index + 1, doneCallback), 25);
        } else {
          const footer = document.createElement('div');
          footer.innerHTML = "<br/><br/>-- The Mentor, 1986<br/><br/>";
          terminal.insertBefore(footer, prompt);
          scrollToBottom();
          doneCallback();
        }
      }

      function showRandomQuote() {
        const quote = quotes[Math.floor(Math.random() * quotes.length)];
        terminal.innerHTML = '';
        terminal.appendChild(prompt); // preserve prompt
        typeQuote(quote, 0, () => {
          commandBuffer = "";
          updatePrompt();
          prompt.style.visibility = 'visible';
        });
      }

      function enableTyping() {
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Backspace') {
            commandBuffer = commandBuffer.slice(0, -1);
            updatePrompt();
          } else if (e.key === 'Enter') {
            const commandLine = document.createElement('div');
            commandLine.innerText = `root@cha:~# ${commandBuffer}`;
            terminal.insertBefore(commandLine, prompt);
            scrollToBottom();

            const cmd = commandBuffer.trim().toLowerCase();
            prompt.style.visibility = 'hidden';

            if (cmd === "cat manifesto.txt") {
              setTimeout(showRandomQuote, 400);
            } else if (cmd === "ls") {
              const out = document.createElement('div');
              out.innerHTML = "meetings/   contact/   manifesto.txt   blog/   code/<br/><br/>";
              terminal.insertBefore(out, prompt);
              commandBuffer = "";
              updatePrompt();
              prompt.style.visibility = 'visible';
            } else if (cmd === "cd meetings" || cmd === "cd meetings/") {
              window.location.href = "meetings.html";
            } else if (cmd === "cd contact" || cmd === "cd contact/") {
              window.location.href = "contact.html";
            } else if (cmd === "cd blog" || cmd === "cd blog/") {
              window.location.href = "blog.html";
            } else if (cmd === "cd code" || cmd === "cd code/") {
              const out = document.createElement('div');
              out.innerHTML = "Opening source tree at github.com/dc423...<br/><br/>";
              terminal.insertBefore(out, prompt);
              scrollToBottom();
              setTimeout(() => {
                window.open("https://github.com/dc423", "_blank");
                setTimeout(() => {
                  terminal.innerHTML = "";
                  terminal.appendChild(prompt);
                  commandBuffer = "";
                  updatePrompt();
                  prompt.style.visibility = 'visible';
                }, 400);
              }, 800);
            } else if (cmd === "whoami") {
              const out = document.createElement('div');
              if (Math.random() < 0.1) {
                out.innerHTML = `idk... who are <i>you</i>?<br/><br/>`;
              } else {
                out.innerHTML = `root<br/><br/>`;
              }
              terminal.insertBefore(out, prompt);
              commandBuffer = "";
              updatePrompt();
              prompt.style.visibility = 'visible';
            } else {
              const out = document.createElement('div');
              out.innerHTML = `bash: command not found: ${escapeHtml(commandBuffer)}<br/><br/>`;
              terminal.insertBefore(out, prompt);
              commandBuffer = "";
              updatePrompt();
              prompt.style.visibility = 'visible';
            }
          } else if (e.key.length === 1) {
            commandBuffer += e.key;
            updatePrompt();
          }
        });
      }

      function buildMotdLines(ip) {
        const ipLine = ip.includes(":")
          ? "OMG IPV6 HACKER"
          : `SERVER IP: ${ip}`;

        const contentLines = [
          "Welcome to NoogaHackers",
          ipLine,
          "",
          "We're currently building something awesome.",
          "Stay tuned..."
        ];

        const boxWidth = Math.max(...contentLines.map(line => line.length));
        const border = "+" + "-".repeat(boxWidth + 4) + "+";

        const padded = contentLines.map(line => {
          const pad = " ".repeat(Math.max(0, boxWidth - line.length));
          return `|  ${line}${pad}  |`;
        });

        return [border, ...padded, border];
      }

      function typeBootLines() {
        if (lineIndex < bootLines.length) {
          const currentLine = bootLines[lineIndex];
          if (charIndex < currentLine.length) {
            const char = document.createTextNode(currentLine.charAt(charIndex));
            terminal.insertBefore(char, prompt);
            scrollToBottom();
            charIndex++;
            setTimeout(typeBootLines, typingSpeed);
          } else {
            const br = document.createElement('br');
            terminal.insertBefore(br, prompt);
            lineIndex++;
            charIndex = 0;
            setTimeout(typeBootLines, lineDelay);
          }
        } else {
          fetch('https://api.ipify.org?format=json')
            .then(res => res.json())
            .then(data => buildMotdLines(data.ip))
            .catch(() => buildMotdLines("UNKNOWN"))
            .then(lines => {
              lines.forEach(line => {
                const div = document.createElement('div');
                div.innerText = line;
                terminal.insertBefore(div, prompt);
              });
              const br = document.createElement('br');
              terminal.insertBefore(br, prompt);
              scrollToBottom();

              // ✅ Only now show the prompt and allow typing
              prompt.style.visibility = 'visible';
              enableTyping();
            });
        }
      }

      typeBootLines();
    });
  </script>
</body>
</html>
